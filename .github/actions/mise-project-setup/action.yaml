name: mise project setup
description: Setup mise and tools for project
inputs:
  cache-mode:
    description: "Mode of operation regarding cache: 'prepare' or 'use'"
    required: false
    default: use

runs:
  using: composite
  steps:
    - id: init

      env:
        CACHE_MODE: ${{ inputs.cache-mode }}
        # renovate: datasource=github-releases depName=jdx/mise
        MISE_VERSION: v2025.10.17
      run: |
        # Initialize mise-project-setup action
        "${GITHUB_ACTION_PATH}/init.sh"
      shell: bash

    - name: Install mise
      uses: jdx/mise-action@e3d7b8d67a7958d1207f6ed871e83b1ea780e7b0 # v3.3.1
      with:
        cache_save: ${{ inputs.cache-mode == 'prepare' }}
        version: ${{ steps.init.outputs.mise-version }}

    - run: |
        # Ensure tools are installed properly
        mise ls --current
        count=$(mise ls --current --missing --no-header | wc -l)
        if [ $count -gt 0 ]; then
          echo "::error::Count of missing tools: $count"
          exit 1
        else
          echo "Result of check: no missing tools"
        fi
      shell: bash
